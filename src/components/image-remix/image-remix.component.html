<div class="space-y-6">
  <div>
    <h2 class="text-2xl font-bold text-white">Style Transfer</h2>
    <p class="mt-1 text-gray-400">Apply the style of one image to the content of another.</p>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
    <div class="space-y-4">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-300">1. Content Image</label>
          <input #contentFileInput type="file" (change)="onContentFileChange($event)" accept="image/*" class="hidden">
          <div 
            (click)="triggerFileInput(contentFileInput)"
            class="mt-1 flex flex-col justify-center items-center rounded-lg border border-dashed border-gray-600 px-6 py-10 h-48 cursor-pointer hover:border-indigo-500 transition-colors bg-white/5">
            @if (contentImage()) {
              <div class="text-center">
                <img [src]="'data:' + contentImage()!.mimeType + ';base64,' + contentImage()!.base64" alt="Content preview" class="mx-auto max-h-24 w-auto rounded-md">
                <p class="mt-2 text-sm text-gray-400 truncate max-w-xs">{{ contentImage()?.name }}</p>
              </div>
            } @else {
              <div class="text-center">
                 <svg class="mx-auto h-12 w-12 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                </svg>
                <p class="mt-4 text-sm leading-6 text-gray-400">Click to upload</p>
              </div>
            }
          </div>
        </div>
         <div>
          <label class="block text-sm font-medium text-gray-300">2. Style Image</label>
          <input #styleFileInput type="file" (change)="onStyleFileChange($event)" accept="image/*" class="hidden">
          <div 
            (click)="triggerFileInput(styleFileInput)"
            class="mt-1 flex flex-col justify-center items-center rounded-lg border border-dashed border-gray-600 px-6 py-10 h-48 cursor-pointer hover:border-indigo-500 transition-colors bg-white/5">
            @if (styleImage()) {
              <div class="text-center">
                <img [src]="'data:' + styleImage()!.mimeType + ';base64,' + styleImage()!.base64" alt="Style preview" class="mx-auto max-h-24 w-auto rounded-md">
                <p class="mt-2 text-sm text-gray-400 truncate max-w-xs">{{ styleImage()?.name }}</p>
              </div>
            } @else {
              <div class="text-center">
                 <svg class="mx-auto h-12 w-12 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.5 21.75l-.398-1.178a3.375 3.375 0 00-2.456-2.456L12.75 18l1.178-.398a3.375 3.375 0 002.456-2.456L17.25 14.25l.398 1.178a3.375 3.375 0 002.456 2.456L21 18.75l-1.178.398a3.375 3.375 0 00-2.456 2.456z" />
                </svg>
                <p class="mt-4 text-sm leading-6 text-gray-400">Click to upload</p>
              </div>
            }
          </div>
        </div>
      </div>
      
      <div>
        <label for="remix-prompt" class="block text-sm font-medium text-gray-300">3. Describe your desired result (optional)</label>
        <input
          id="remix-prompt"
          type="text"
          [value]="prompt()"
          (input)="updatePrompt($event)"
          class="mt-1 block w-full rounded-md border-0 bg-white/5 py-2 px-3 text-white shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6 transition"
          placeholder="e.g., Make the colors more vibrant"
        />
        <div 
          (click)="togglePromptSuggestions()"
          class="mt-3 p-3 border border-dashed border-gray-600 rounded-md cursor-pointer hover:border-indigo-500 hover:bg-white/5 transition-all text-center"
        >
          <p class="text-sm font-medium text-gray-300">Explore Prompt Library</p>
          <p class="text-xs text-indigo-400">
            {{ showPromptSuggestions() ? 'Click to hide' : 'Click to show' }}
          </p>
        </div>

        @if (showPromptSuggestions()) {
          <div class="mt-2 rounded-lg border border-gray-700 bg-gray-900/50 h-80 flex overflow-hidden">
            <!-- Categories Panel -->
            <div class="w-1/3 border-r border-gray-700 overflow-y-auto">
              <nav class="p-2 space-y-1">
                @for (category of promptCategories; track category.name) {
                  <button
                    (click)="selectCategory(category)"
                    class="w-full text-left p-2 text-sm rounded-md transition-colors"
                    [class]="activeCategory() === category
                      ? 'bg-indigo-600 text-white'
                      : 'text-gray-300 hover:bg-white/10 hover:text-white'"
                  >
                    {{ category.name }}
                  </button>
                }
              </nav>
            </div>
            <!-- Prompts Panel -->
            <div class="w-2/3 overflow-y-auto">
              <div class="p-2 space-y-1">
                @for (suggestion of activeCategory().prompts; track suggestion) {
                  <button 
                    (click)="selectSuggestedPrompt(suggestion)"
                    class="w-full text-left p-2 text-sm text-gray-400 rounded-md hover:bg-indigo-600/50 hover:text-white transition-colors"
                    title="{{ suggestion }}"
                  >
                    {{ suggestion }}
                  </button>
                }
              </div>
            </div>
          </div>
        }
      </div>

       <div class="text-right">
        <button
          (click)="applyStyleTransfer()"
          [disabled]="isLoading() || !contentImage() || !styleImage()"
          class="w-full sm:w-auto inline-flex items-center justify-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        >
          Apply Style
        </button>
      </div>
    </div>
    
    <div class="relative min-h-[20rem] bg-gray-900/50 rounded-lg p-4 ring-1 ring-white/10 flex items-center justify-center">
      @if (isLoading()) {
        <div class="text-center">
          <app-loading-spinner />
          <p class="mt-2 text-sm text-indigo-300">{{ loadingStep() }}</p>
        </div>
      } @else if (error()) {
          <div class="rounded-md bg-red-900/50 p-4 border border-red-700 w-full">
              <p class="text-sm text-red-300">{{ error() }}</p>
          </div>
      } @else if (result()) {
         <div class="rounded-lg overflow-hidden ring-1 ring-white/10">
            <img [src]="result()" alt="Remixed image" class="w-full h-auto object-contain" />
         </div>
      } @else {
         <div class="text-center text-gray-500">
            <p>Your new image will appear here.</p>
         </div>
      }
    </div>
  </div>
</div>